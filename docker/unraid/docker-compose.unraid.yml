# Housarr Docker Compose for Unraid
# Simplified production setup optimized for Unraid
#
# Usage:
#   1. Copy this file to /mnt/user/appdata/housarr/
#   2. Create .env file with your settings
#   3. Run: docker compose -f docker-compose.unraid.yml up -d

services:
  housarr:
    build:
      context: ../..
      dockerfile: docker/app/Dockerfile
    container_name: housarr
    restart: unless-stopped
    ports:
      - "${APP_PORT:-8000}:80"
    volumes:
      # Persistent data - IMPORTANT: Map these to your Unraid shares
      - ${DATA_PATH:-/mnt/user/appdata/housarr/data}:/var/www/html/storage/app
      - ${DB_PATH:-/mnt/user/appdata/housarr/database}:/var/www/html/database
      - ${LOGS_PATH:-/mnt/user/appdata/housarr/logs}:/var/www/html/storage/logs
    environment:
      # Application
      - APP_ENV=production
      - APP_DEBUG=false
      - APP_KEY=${APP_KEY:?APP_KEY is required}
      - APP_URL=${APP_URL:-http://localhost:8000}
      
      # Database (SQLite by default - simpler for Unraid)
      - DB_CONNECTION=${DB_CONNECTION:-sqlite}
      - DB_DATABASE=/var/www/html/database/database.sqlite
      
      # Optional: MySQL (uncomment if using external MySQL/MariaDB)
      # - DB_CONNECTION=mysql
      # - DB_HOST=${DB_HOST:-mariadb}
      # - DB_PORT=${DB_PORT:-3306}
      # - DB_DATABASE=${DB_DATABASE:-housarr}
      # - DB_USERNAME=${DB_USERNAME:-housarr}
      # - DB_PASSWORD=${DB_PASSWORD}
      
      # Cache & Session
      - CACHE_STORE=file
      - SESSION_DRIVER=file
      - QUEUE_CONNECTION=sync
      
      # Timezone
      - TZ=${TZ:-America/New_York}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/up"]
      interval: 30s
      timeout: 10s
      retries: 3
    labels:
      - "net.unraid.docker.icon=https://raw.githubusercontent.com/jpittelkow/Housarr/main/frontend/public/vite.svg"
      - "net.unraid.docker.webui=http://[IP]:[PORT:8000]"

# Optional: Add MariaDB if you need MySQL instead of SQLite
#  mariadb:
#    image: mariadb:10.11
#    container_name: housarr-db
#    restart: unless-stopped
#    environment:
#      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
#      - MYSQL_DATABASE=${DB_DATABASE:-housarr}
#      - MYSQL_USER=${DB_USERNAME:-housarr}
#      - MYSQL_PASSWORD=${DB_PASSWORD}
#    volumes:
#      - ${MYSQL_DATA_PATH:-/mnt/user/appdata/housarr/mysql}:/var/lib/mysql
