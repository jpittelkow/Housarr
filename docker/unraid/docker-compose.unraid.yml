# Housarr - Single Container for Unraid
# Pre-configured for SQLite (no external database needed)
#
# Quick Start:
#   1. Copy this folder to /mnt/user/appdata/housarr/
#   2. Copy env.example to .env and update APP_KEY
#   3. Run: docker compose -f docker-compose.unraid.yml up -d
#
# First run will build the image (~5 min) and initialize the database.

services:
  housarr:
    build:
      context: ../..
      dockerfile: docker/app/Dockerfile
    container_name: housarr
    restart: unless-stopped
    ports:
      - "${APP_PORT:-8000}:80"
    volumes:
      # Database - SQLite file persistence
      - ${APPDATA_PATH:-/mnt/user/appdata/housarr}/database:/var/www/html/database
      # Uploaded files (manuals, images, etc.)
      - ${APPDATA_PATH:-/mnt/user/appdata/housarr}/storage:/var/www/html/storage/app
      # Logs
      - ${APPDATA_PATH:-/mnt/user/appdata/housarr}/logs:/var/www/html/storage/logs
    environment:
      # Application
      APP_ENV: production
      APP_DEBUG: "false"
      APP_KEY: ${APP_KEY:?Generate APP_KEY - see env.example}
      APP_URL: ${APP_URL:-http://localhost:8000}
      
      # SQLite Database (simple, no external DB needed)
      DB_CONNECTION: sqlite
      DB_DATABASE: /var/www/html/database/database.sqlite
      
      # File-based cache/session (no Redis needed)
      CACHE_STORE: file
      SESSION_DRIVER: file
      QUEUE_CONNECTION: sync
      
      # Timezone
      TZ: ${TZ:-America/New_York}
      
      # Optional mail settings (configure in UI or here)
      MAIL_MAILER: ${MAIL_MAILER:-log}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/up"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    labels:
      net.unraid.docker.icon: "https://raw.githubusercontent.com/jpittelkow/Housarr/main/frontend/public/vite.svg"
      net.unraid.docker.webui: "http://[IP]:[PORT:8000]"
